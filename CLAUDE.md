# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

VisionC2 is a multi-architecture C2 framework written in Go, designed for penetration testing and security research. It features a TUI-based control panel (Bubble Tea), layered encryption, cross-architecture bot compilation (14 architectures), L4/L7 attack methods, SOCKS5 proxying, and anti-analysis capabilities.

## Build & Development Commands

### Full Setup (first time)
```bash
python3 setup.py
```
Interactive wizard that configures C2 address, generates crypto tokens, TLS certificates, updates source files, and builds everything.

### Build CNC Server
```bash
go build -o cnc/cnc ./cnc
```

### Build Bot (single architecture, e.g. amd64)
```bash
GOOS=linux GOARCH=amd64 go build -trimpath -ldflags="-s -w -buildid=" -o bins/bot ./bot
```

### Build All Bot Architectures (14 targets)
```bash
bash tools/build.sh
```
Produces binaries in `bins/` with kernel-like names, applies `strip`, UPX compression, and UPX signature stripping.

### Encrypt/Decrypt Strings (for config)
```bash
go run tools/crypto.go
```
AES-128-CTR tool for encrypting sensitive strings that go into `bot/config.go`.

### Run CNC
```bash
./cnc/cnc
```
Listens on port 443 (bot TLS) and port 442 (admin CLI).

## Architecture

### Two Main Components

- **`cnc/`** — Command & Control server. Dual-listener architecture: TLS on port 443 for bot connections, plain TCP on port 442 for operator access. Interactive TUI built with Bubble Tea (`ui.go` is ~3300 LOC and the largest file). RBAC with four permission levels (Basic/Pro/Admin/Owner) defined in `users.json`.

- **`bot/`** — Agent deployed to targets. Connects back to CNC over TLS 1.3. Lifecycle: decrypt config → daemonize → singleton lock → sandbox detection → install persistence → DNS-resolve C2 → connect with reconnect loop.

### Key Source Files

| File | Purpose |
|------|---------|
| `bot/config.go` | All configuration constants: obfuscated C2 address (`gothTits`), crypto seed, magic code, protocol version, encrypted string blobs |
| `bot/connection.go` | TLS connection, multi-method DNS resolution chain (DoH → UDP → A record → raw) |
| `bot/attacks.go` | All L4/L7 DDoS methods (~2100 LOC) |
| `bot/opsec.go` | AES encryption, key derivation, sandbox/VM/debugger detection |
| `bot/persist.go` | Persistence via systemd, cron, rc.local |
| `bot/socks.go` | SOCKS5 proxy with RFC 1929 auth |
| `cnc/ui.go` | Bubble Tea TUI — all views, keybindings, rendering |
| `cnc/cmd.go` | Command dispatch and routing to bots |
| `cnc/connection.go` | Bot connection handling, TLS setup, heartbeat |
| `cnc/miscellaneous.go` | RBAC, user authentication, utilities |

### Shared Configuration (must match between bot and CNC)

Three values in `bot/config.go` and `cnc/main.go` **must be identical** for communication to work:
- `magicCode` / `MAGIC_CODE` — 16-char auth token
- `protocolVersion` / `PROTOCOL_VERSION` — version string
- `cryptSeed` — 8-char hex seed (bot-side only, used for C2 address decoding)

These are auto-configured by `setup.py`.

## Naming Conventions (Intentional Obfuscation)

Function names are deliberately obfuscated. Understanding the naming scheme is essential:

- **APT group names** → core bot operations (e.g., `anonymousSudan` = C2 handler, `sidewinder` = shell exec, `winnti` = sandbox detect, `dragonfly` = persistence installer)
- **Pokémon (attack methods)** → DDoS functions (e.g., `snorlax` = UDP flood, `alakazam` = HTTP flood, `dragonite` = SYN flood)
- **Pokémon (DNS)** → DNS resolution chain (`dialga` → `palkia` → `darkrai` → `rayquaza`)
- **Pokémon (crypto)** → encryption functions (`charizard` = key derivation, `venusaur` = C2 decoder, `garuda` = AES-128-CTR)
- **Mythical Pokémon** → 16 functions that each return one byte of the encryption key (`mew`, `mewtwo`, `celebi`, etc.)

## Encryption Architecture

- **C2 address**: 5-layer encoding pipeline (MD5 checksum → byte substitution → RC4 → XOR rotating key → base64)
- **Sensitive strings**: AES-128-CTR with key derived from 16 split functions. Encrypted at build time via `tools/crypto.go`, decrypted at runtime by `initSensitiveStrings()`
- **Transport**: TLS 1.3 with self-signed certificates (generated by `setup.py` in `cnc/certificates/`)

## Go Module

Module name is `Vision` (in `go.mod`). Import paths use this prefix. Requires Go 1.24.0+.

## Documentation

Detailed docs live in `Docs/`:
- `ARCHITECTURE.md` — deep technical reference (~800 lines)
- `USAGE.md` — setup and operation guide
- `COMMANDS.md` — TUI hotkey reference
- `CHANGELOG.md` — version history
